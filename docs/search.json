[
  {
    "objectID": "images/fig-rr-9.html",
    "href": "images/fig-rr-9.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Constant-\\(g_m\\) reference"
  },
  {
    "objectID": "images/fig-rr-7.html",
    "href": "images/fig-rr-7.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Ideal closed loop gain calculation"
  },
  {
    "objectID": "images/fig-rr-5.html",
    "href": "images/fig-rr-5.html",
    "title": "",
    "section": "",
    "text": "Figure 1: AC equivalent model of the feedback circuit in ?@fig-rr-4"
  },
  {
    "objectID": "images/fig-rr-3.html",
    "href": "images/fig-rr-3.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram model for closed-loop gain using the two-port framework"
  },
  {
    "objectID": "images/fig-rr-16.html",
    "href": "images/fig-rr-16.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Constant-\\(g_m\\) reference: possible problem"
  },
  {
    "objectID": "images/fig-rr-14.html",
    "href": "images/fig-rr-14.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal equivalent model for the constant-\\(g_m\\) bias circuit"
  },
  {
    "objectID": "images/fig-rr-12.html",
    "href": "images/fig-rr-12.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal equivalent model for the constant-\\(g_m\\) bias circuit, (a) red: circuit features that make \\(s_t\\) insertion not possible, (b) blue: best place for \\(s_t\\) insertion"
  },
  {
    "objectID": "images/fig-rr-10.html",
    "href": "images/fig-rr-10.html",
    "title": "",
    "section": "",
    "text": "Figure 1: AC equivalent model of the constant-\\(g_m\\) bias circuit"
  },
  {
    "objectID": "images/fig-fb-oa-9.html",
    "href": "images/fig-fb-oa-9.html",
    "title": "",
    "section": "",
    "text": "Figure 1: op amp based inverting amplifier with break in the loop (\\(v_{in} = 0\\))"
  },
  {
    "objectID": "images/fig-fb-oa-7.html",
    "href": "images/fig-fb-oa-7.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Breaking the loop (\\(v_{in}=0\\))"
  },
  {
    "objectID": "images/fig-fb-oa-3.html",
    "href": "images/fig-fb-oa-3.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Breaking the Loop."
  },
  {
    "objectID": "images/fig-fb-oa-10.html",
    "href": "images/fig-fb-oa-10.html",
    "title": "",
    "section": "",
    "text": "Figure 1: comparison between inverting and non-inverting topology"
  },
  {
    "objectID": "images/fig-fb-8.html",
    "href": "images/fig-fb-8.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Effect of negative feedback on non-linearity"
  },
  {
    "objectID": "images/fig-fb-5.html",
    "href": "images/fig-fb-5.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram of a non inverting voltage amplifier (series-shunt feedback)"
  },
  {
    "objectID": "images/fig-fb-3.html",
    "href": "images/fig-fb-3.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram of a voltage buffer."
  },
  {
    "objectID": "images/fig-fb-15.html",
    "href": "images/fig-fb-15.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram of negative feedback system."
  },
  {
    "objectID": "images/fig-bf-9.html",
    "href": "images/fig-bf-9.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Finding T(with output port shorted), \\(-v_d=v_{out}=0\\)"
  },
  {
    "objectID": "images/fig-bf-7.html",
    "href": "images/fig-bf-7.html",
    "title": "",
    "section": "",
    "text": "Figure 1: T(with output port open) for non-inverting configuration"
  },
  {
    "objectID": "images/fig-bf-5.html",
    "href": "images/fig-bf-5.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Output resistance of non-inverting op amp circuit"
  },
  {
    "objectID": "images/fig-bf-3.html",
    "href": "images/fig-bf-3.html",
    "title": "",
    "section": "",
    "text": "Figure 1: T(with input port shorted) for non inverting configuration"
  },
  {
    "objectID": "images/fig-bf-27.html",
    "href": "images/fig-bf-27.html",
    "title": "",
    "section": "",
    "text": "Figure 1: return ratio with output port open"
  },
  {
    "objectID": "images/fig-bf-25.html",
    "href": "images/fig-bf-25.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal model to find the return ratio of \\(g_{m}\\)"
  },
  {
    "objectID": "images/fig-bf-23.html",
    "href": "images/fig-bf-23.html",
    "title": "",
    "section": "",
    "text": "Figure 1: return ratio with port G-S open"
  },
  {
    "objectID": "images/fig-bf-21.html",
    "href": "images/fig-bf-21.html",
    "title": "",
    "section": "",
    "text": "Figure 1: ZVTC calculations"
  },
  {
    "objectID": "images/fig-bf-2.html",
    "href": "images/fig-bf-2.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Input resistance of non-inverting op amp circuit"
  },
  {
    "objectID": "images/fig-bf-18.html",
    "href": "images/fig-bf-18.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Active cascode gain stage"
  },
  {
    "objectID": "images/fig-bf-16.html",
    "href": "images/fig-bf-16.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal model of the shunt-shunt stage"
  },
  {
    "objectID": "images/fig-bf-14.html",
    "href": "images/fig-bf-14.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Return Ratio for \\(g_{m2}\\) with the output port open"
  },
  {
    "objectID": "images/fig-bf-12.html",
    "href": "images/fig-bf-12.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small-signal model of the super-source follower"
  },
  {
    "objectID": "images/fig-bf-10.html",
    "href": "images/fig-bf-10.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Finding T(with output port open), \\(v_{out}=-v_d=-v_{gs} + v_t\\)"
  },
  {
    "objectID": "feedback.html",
    "href": "feedback.html",
    "title": "Introduction to Feedback",
    "section": "",
    "text": "In electronics the term feedback refers to the situation where a signal sensed (or derived or sampled or measured) from the output port of an amplifier is returned to the input port, where it is combined with the externally applied input signal to create a new signal to be processed by the amplifier itself.\n\nwhen the returned signal is added to the external signal, we have positive feedback (a.k.a. regenerative feddback)\nwhen the returned signal is subtracted we have negative feedback (a.k.a. degenerative feedback)\n\nNegative feedback was conceived in 1928 by Harold Black.\n\n\n\n\n\n\n\n\nFigure 1: Block diagram of a feedback system."
  },
  {
    "objectID": "feedback.html#preliminaries",
    "href": "feedback.html#preliminaries",
    "title": "Introduction to Feedback",
    "section": "",
    "text": "In electronics the term feedback refers to the situation where a signal sensed (or derived or sampled or measured) from the output port of an amplifier is returned to the input port, where it is combined with the externally applied input signal to create a new signal to be processed by the amplifier itself.\n\nwhen the returned signal is added to the external signal, we have positive feedback (a.k.a. regenerative feddback)\nwhen the returned signal is subtracted we have negative feedback (a.k.a. degenerative feedback)\n\nNegative feedback was conceived in 1928 by Harold Black.\n\n\n\n\n\n\n\n\nFigure 1: Block diagram of a feedback system."
  },
  {
    "objectID": "feedback.html#systematic-feedback-analysis-frameworks",
    "href": "feedback.html#systematic-feedback-analysis-frameworks",
    "title": "Introduction to Feedback",
    "section": "2 Systematic Feedback Analysis Frameworks",
    "text": "2 Systematic Feedback Analysis Frameworks\n\nTwo-port Analysis\n\nProposed by Harold Black\nHelpful for gaining basic intuition about feedback\nMap the feedback network onto one of four topologies\n\nvoltage-voltage (serie-shunt), current-voltage (shunt-shunt), voltage-current (series-series), current-current (shunt-series), depending on the desired input/output quantities\n\nIn practice, the feedback network “\\(b\\)” (and possibly the forward amplifier “\\(a\\)”) are not unilateral, so mapping arbitrary circuits into a generic “\\(ab\\)” block diagram that uses two-ports is not obvious\nThe feedback network causes loading at the input and output of the basic amplifier\n\nmodel the feedback network as an ideal two-port and absorb the loading effects into the forward amplifier. This procedure is often quite tedious.\n\n\nSome feedback circuits cannot be modeled using two-ports\n\ne.g. bias circuits with feedback loops tend to have only one port\n\n\nReturn Ratio Analysis\n\nProposed by Hendrik Bode\n“Asymptotic” method. It does no attempt to break the circuit into pieces\nThe closed-loop properties of the feedback circuit are described in terms of the return ratio of a dependent source in an active device\nThe block diagram used to analyze the closed loop properties of the feedback circuit is extended to handle the feedforward through the feedback network\nOften easier than two-port analysis"
  },
  {
    "objectID": "feedback.html#negative-feedback",
    "href": "feedback.html#negative-feedback",
    "title": "Introduction to Feedback",
    "section": "3 Negative Feedback",
    "text": "3 Negative Feedback\n\nBasic Idea\n\ntrade off gain for other desirable properties\n\nDesirable properties \n\ndesentisize gain\nextend the bandwidth\ncontrol input and output impedance\nreduce NL distorsion\n\nDrawbacks (undesired properties)\n\nreduced gain\nunder certain circumstances the negative feedback in an amplifier can become positive and of such a magnitude as to cause oscillations (instability)\n\n\nNOTE: it should not be implied that positive feedback always lead to instability"
  },
  {
    "objectID": "feedback.html#general-negative-feedback-structure",
    "href": "feedback.html#general-negative-feedback-structure",
    "title": "Introduction to Feedback",
    "section": "4 General negative feedback structure",
    "text": "4 General negative feedback structure\n\n\n\n\n\n\n\n\nFigure 2: Block diagram of a negative feedback system.\n\n\n\n\n\nBasic Terminology:\n\\(s_{in}\\) = input signal applied to the feedback system\n\\(s_{out}\\) = output signal from the feedback system\n\\(a = \\dfrac{s_{out}}{s_i}\\) = open-loop gain = gain of “basic” amplifier = gain of feedforward amplifier\n\\(b\\) = feedback factor\n\\(a \\cdot b = L\\) = loop gain (it is always unit-less)\n\\(1 + ab = 1 + L\\) = amount of feedback\n\\(s_i \\equiv s_ \\epsilon \\equiv s_d = s_{in} - s_f\\) = input to “basic” amplifier = error = difference\n\\(A = \\dfrac{s_{out}}{s_{in}}\\) = closed-loop gain = gain of feedback system\nIdeal feedback assumptions\n\nthe feedback network does not load the basic amplifier output\nthe feedback network does not load the basic amplifier input\nthe feedback network is unilateral\nthe basic amplifier is unilateral\n\nClosed-loop gain expression\nThe feedback network measures (or samples or senses) the output signal \\(s_{out}\\) and provides (returns) a feedback signal \\(s_f\\) (that is related to \\(s_{out}\\) by the feedback factor b) \\[\n\\begin{split}\ns_{out} &= a \\cdot s_i \\\\\ns_{f} &= b \\cdot s_{out} \\\\\ns_ \\epsilon &\\equiv s_d \\equiv s_i = s_{in} - s_f\n\\end{split}\n\\]\n\\[\n\\begin{split}\nA &= \\frac{s_{out}}{s_{in}} = \\frac{s_{out}}{s_i + s_f} = \\frac{1}{\\dfrac{s_i}{s_{out}} + \\dfrac{s_f}{s_{out}}} = \\frac{1}{\\dfrac{1}{a} + b} = \\frac{a}{1+ab} = \\\\\n  &= \\frac{1}{b} \\cdot \\frac{1}{1 + 1/(ab)} = \\frac{1}{b} \\cdot \\frac{1}{1 + \\dfrac{1}{L}} = \\frac{1}{b} \\cdot \\frac{L}{1+L} \\approx \\frac{1}{b}\n\\end{split}\n\\]\nThe most important benefit coming from the use of negative feedback is under the condition \\(L \\gg 1\\):\n\nfor \\(L \\gg 1\\) the actual gain \\(A (\\approx 1/b)\\) is virtually independent of the open-loop gain \\(a\\). The open-loop gain \\(a\\) is typically an extremely inaccurate parameter, and varies significantly subject to drift with temperature, supply voltage, fabrication process, and DC biasing conditions.\n\nAlthough physically unattainable the limit \\(L \\rightarrow \\infty\\) represent the ideal condition:\n\\[\nA_{ideal} = \\lim\\limits_{L \\to \\infty} A = \\frac{1}{b}\n\\]\nKey result: when the loop gain \\(L\\) is large, the closed loop gain \\(A\\) approaches the ideal closed loop gain \\(A_{ideal}\\), which is equal to \\(1/b\\)\nTo achieve gain we need \\(b \\leq 1\\).\n\\(b \\leq 1\\) is easy to implement. We can for example use a wire (\\(b=1\\)), or a resistive divider (ratiometric) or a capacitive divider (ratiometric).\nExample 1 - voltage buffer\n\\(v_f = v_{out} \\Rightarrow b = v_f/v_{out} = 1\\)\n\\(v_{out} = a \\cdot (v_{in} - v_{out})\\)\n\\(v_{out} (1+a) = a \\cdot v_{in}\\)\n\\(\\dfrac{v_{out}}{v_{in}} = \\dfrac{a}{1+a} \\approx 1\\)\n\n\n\n\n\n\n\n\nFigure 3: Block diagram of a voltage buffer.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 4: op amp based voltage buffer\n\n\n\n\n\nExample 2 - non-inverting voltage amplifier\n\\(b = \\dfrac{v_f}{v_{out}} = \\dfrac{R_1}{R_1+R_2}\\)\n\\(\\dfrac {v_{out}}{v_{in}} \\approx \\dfrac{1}{b} = 1 + \\dfrac{R_2}{R_1}\\)\n\n\n\n\n\n\n\n\nFigure 5: Block diagram of a non inverting voltage amplifier (series-shunt feedback)\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 6: op amp based non inverting voltage amplifier\n\n\n\n\n\nIf we regard \\(1/L\\) as an error term, then \\(L\\) gives a measure of how close the actual gain \\(A\\) is to the ideal gain \\(A_{ideal} = 1/b\\).\n\\[\nA = \\frac{1}{b} \\cdot  \\frac{1}{1 + \\dfrac{1}{L}} \\approx  \\frac{1}{b} \\cdot \\Bigl(  1 - \\dfrac{1}{L} \\Bigr)\n\\]\nThe % gain error between actual gain \\(A\\) and ideal gain \\(A_{ideal}\\) is usually defined as follows:\n\\[\n\\begin{split}\ngain \\space error \\space \\% &= 100 \\times \\frac{A - A_{ideal}}{A_{ideal}} = 100 \\times \\frac{A_{ideal} \\cdot \\Bigl ( \\dfrac{1}{1 + 1/L} \\Bigr ) - A_{ideal}}{A_{ideal}} = \\\\\n&= 100 \\times \\frac{-1}{1+L} \\approx 100 \\times \\frac{-1}{L}\n\\end{split}\n\\]\nExample 3 - op amp based non inverting voltage amplifier\nKLC at node \\(v_{out}\\):\n\\[\n\\frac{v_N - v_{out}}{R_2} = \\frac{v_{out} - a_D \\cdot (v_{in} - v_N)}{r_o}\n\\]\nKCL at node \\(v_{N}\\): \\[\n\\frac{v_N - v_{in}}{r_i} + \\frac{v_N}{R_1} + \\frac{v_N - v_{out}}{R_2} = 0\n\\]\n\n\n\n\n\n\nFigure 7: Non inverting voltage amplifier with non ideal op amp (Franco 2015)\n\n\n\nFor \\(a_D = 10^6\\), \\(r_i = 10 M \\Omega\\), \\(r_o = 10 \\Omega\\), \\(R_1 = 20 k \\Omega\\) and \\(R_2 = 80 k \\Omega\\):\n\\[\n\\begin{split}\nA_{ideal} &= \\frac{R_1+R_2}{R_1} \\\\\nA &= \\frac{v_{out}}{v_{in}} = \\frac{a_D \\cdot r_i (R_1 + R_2) + R_1 r_o}{a_D \\cdot R_1 r_i + r_o (R_1 + r_i) + R_1R_2 + r_i(R_1+R_2)} = 4.999975 \\\\\n\\\\\ngain \\space error &= \\frac{4.999975 -5}{5} = -5 \\cdot 10^{-6} = -5 ppm\n\\end{split}\n\\]\nThe exact analysis is very tedious. A better way to obtain the same insight is to use the simpler approach shown in example 4."
  },
  {
    "objectID": "feedback.html#the-error-signal-s_epsilon-and-the-feedback-signal-s_f",
    "href": "feedback.html#the-error-signal-s_epsilon-and-the-feedback-signal-s_f",
    "title": "Introduction to Feedback",
    "section": "5 The error signal \\(s_\\epsilon\\) and the feedback signal \\(s_{f}\\)",
    "text": "5 The error signal \\(s_\\epsilon\\) and the feedback signal \\(s_{f}\\)\nFrom Figure 2\n\\[\n\\begin{split}\ns_ \\epsilon &= \\dfrac{s_{out}}{a} = \\dfrac{A \\cdot s_{in}}{a} = \\frac{\\cancel a}{1+L} \\cdot \\frac{s_{in}}{\\cancel a} \\\\\n&= \\dfrac{s_{in}}{1+L}\n\\end{split}\n\\]\nalso\n\\[\n\\begin{split}\ns_f &= b \\cdot s_{out} = b \\cdot A \\cdot s_{in} = \\cancel {b} \\cdot \\frac{1}{\\cancel{b}} \\frac{1}{1+1/L} \\cdot s_{in} \\\\\n&= \\dfrac{s_{in}}{1+1/L}\n\\end{split}\n\\]\nThese results show that for a large loop gain (ideally for \\(L \\rightarrow \\infty\\)), the error signal becomes very small (ideally \\(s_ \\epsilon \\rightarrow 0\\)), causing the feedback signal \\(s_f\\) to closely follow the input signal \\(s_{in}\\) (\\(s_f \\rightarrow s_{in}\\)).\nIf the feedback signal closely tracks the input signal, then the output signal is also a close “replica” of the input signal, and therefore feedback is also effective in reducing distorsion due to small signals. Low frequency distorsion is caused by changes in the slope of the basic-amplifier transfer characteristic (i.e. changes in the small signal gain of the basic-amplifier)."
  },
  {
    "objectID": "feedback.html#benefits-of-negative-feedback",
    "href": "feedback.html#benefits-of-negative-feedback",
    "title": "Introduction to Feedback",
    "section": "6 Benefits of negative feedback",
    "text": "6 Benefits of negative feedback\n\n6.1 Gain Desensitivity\nTo investigate the effect that a variation on the open-loop gain \\(a\\) causes on the closed-loop gain \\(A\\) we differentiate \\(A\\) w.r.t. \\(a\\) \\[\nA = \\dfrac{a}{1+ab}\n\\] \\[\n\\dfrac{dA}{da} = \\dfrac{ 1 + ab - ab}{(1+ab)^2} = \\dfrac{1}{(1+ab)^2}\n\\] \\[\n\\Delta A = \\dfrac{\\Delta a}{(1+ab)^2}\n\\] \\[\n\\dfrac{\\Delta A}{A} = \\dfrac{\\Delta a}{A} \\cdot \\dfrac{1}{(1 + ab)^2} =\n\\dfrac{\\Delta a}{\\dfrac{a}{1+ab}} \\cdot \\dfrac{1}{(1 + ab)^2} = \\dfrac{\\Delta a / a}{(1+ab)}\n\\] Thanks to feedback, a fractional change in the gain of the basic amplifier is reduced by a factor \\(1+L = 1 + ab\\) in the closed-loop. Conceptually, the loop gain \\(L\\) can be be made arbitrarily large. The loop gain is a key parameter and as we will see later it plays an important role also in bandwidth and impedance calculations.\n\n\n6.2 Effect of feedback on non-linearity\nAmplifiers are made up of transistors. Since, transistors are non-linear devices, the transfer charateristic of any practical amplifier is non-linear. Assume a basic amplifier that besides the desired linear relationship, also exhibits a quadratic and cubic relationship between its input and output.\n\n\n\n\n\n\n\n\nFigure 8: Effect of negative feedback on non-linearity\n\n\n\n\n\n\\[\n\\begin{split}\nv_{out} &= a_1 (v_{in} - b v_{out}) + a_2 (v_{in} -b v_{out})^2 + a_3 (v_{in} - b v_{out})^3\n\\end{split}\n\\tag{1}\\] \\[\n\\begin{split}\n&v_{out} = A_1 v_{in} + A_2 v_{in}^2 + A_3 v_{in}^3 + \\space ...\n\\end{split}\n\\tag{2}\\]\nSubstituting Equation 2 into Equation 1 we get: \\[\n\\begin{split}\nv_{out} = \\space &a_1 (v_{in} - b A_1 v_{in} -b A_2 v_{in}^2 - b A_3 v_{in}^3 - ... ) \\space + \\\\\n& a_2 (v_{in} - b A_1 v_{in} -b A_2 v_{in}^2 - b A_3 v_{in}^3 - ... )^2 \\space + \\\\\n&a_3 (v_{in} - b A_1 v_{in} - b A_2 v_{in}^2 - b A_3 v_{in}^3 - ...)^3 \\space\n\\end{split}\n\\]\nand equating back into Equation 2:\n\nfor the linear term\n\n\\[\n\\begin{split}\n&A_1 {v_{in}} = a_1 {v_{in}} - a_1 b A_1 {v_{in}} \\Leftrightarrow A_1 (1 + a_1 b) = a_1 \\\\\n&A_1 = \\dfrac{a_1}{1+a_1 b}\n\\end{split}\n\\tag{3}\\]\nor: \\[\n\\begin{split}\n&A_1 = a_1 - a_1 b A_1  \\Leftrightarrow A_1 = a_1 (1 - b A_1) \\Leftrightarrow \\\\\n&1 - bA_1 = \\frac{A_1}{a_1} = \\frac{1}{1+a_1b}\\\\\n\\end{split}\n\\tag{4}\\]\n\nfor the quadratic term\n\n\\[\n\\begin{split}\n&A_2 {v_{in}^2} = - a_1 b A_2 {v_{in}^2} + a_2 \\left( v_{in}^2 + b^2 A_1^2 v_{in}^2 - 2 bA_1v_{in}^2 \\right) \\Leftrightarrow \\\\\n&A_2 (1 + a_1b) = a_2 (1 - b A_1)^2 \\Leftrightarrow A_2 = a_2 \\dfrac{(1-bA_1)^2}{1+a_1b} \\Leftrightarrow \\\\\n&A_2 = \\dfrac{a_2}{(1+a_1b)^3}\n\\end{split}  \n\\tag{5}\\]\n\nfor the cubic term\n\n\\[\n\\begin{split}\n&A_3 \\cdot {v_{in}^3} =  - a_1 b A_3 {v_{in}^3} + a_3 (1 - b A_1)^3 {v_{in}^3} - 2 a_2 b A_2 (1-bA_1) v_{in}^3 \\Leftrightarrow \\\\\n&A_3 (1+a_1 b) = a_3  (1 -b A_1 )^3 - 2 a_2b A_2 (1- bA_1) \\Leftrightarrow \\\\\n&A_3 = \\dfrac{a_3 (1 - bA_1)^3 - 2 a_2 b A_2 (1 - bA_1)}{(1+a_1 b)} \\Leftrightarrow \\\\\n&A_3 = \\dfrac{a_3}{(1+a_1 b)^4} - \\dfrac{2 a_2^2b}{(1+a_1b)^5}\n\\end{split}\n\\tag{6}\\]\nThe linear term \\(a_1\\) (as expected) is reduced by \\(1 + L\\), where \\(L\\equiv a_1b\\)\nThe quadratic term \\(a_2\\) is reduced by \\((1 + L)^3\\)\nThe cubic term \\(a_3\\) is reduced by \\((1+L)^4\\), but ther is also an extra term due to the interaction with the second-order term \\(a_2\\)\nIf at different signal levels, the basic amplifier’s small-signal gain varies, since feedback reduces the overall gain variations w.r.t. the gain variations of the basic amplifier, then feedback also reduces distorsion.\nNote:\n\nfeedback reduces distorsion without reducing the output voltage range. The overall gain is reduced, but additional gain can be provided with a preamplifier that operates with smaller signal swings, and therefore less distorsion.\nfeedback does not help with saturation. In the case an amplifier’s output shows hard saturation (i.e., the output become independent of the input), the incremental gain of the basic amplifier \\(\\rightarrow 0\\), so the amount of feedback also \\(\\rightarrow 0\\), and as a result negative feedback cannot improve the situation.\n\n\n\n6.3 Effect of feedback on bandwidth\nAs an example, assume the transfer function of the basic amplifier is the following: \\[\na(j\\omega) = \\dfrac{a_0}{1+\\dfrac{j\\omega}{\\omega_p}}\n\\] Then, the closed-loop transfer function is \\[\nA(j\\omega) = \\dfrac{a(j\\omega)}{1+ a(j\\omega) \\cdot b} = \\dfrac{a_0}{1+ a_0 b} \\cdot \\dfrac{1}{1+\\dfrac{j\\omega}{\\omega_p} \\cdot \\dfrac{1}{(1+ a_0 b)}}\n\\] The gain is reduced by \\(1 + L_0\\), but the bandwidth is increased by \\(1+L_0\\), where \\(L_0=a_0b\\).\nThe product of gain and bandwidth remains constant.\n\n\n\n\n\n\nFigure 9: Gain magnitude vs. frequency for the basic amplifier and the feedback amplifier\n\n\n\n\n\n6.4 Effect of feedback on input/output resistances\nIn actual applications the input and output resistances (a.k.a. terminal resistances) of the amplifier play a key role. When an amplifier is driven by a non ideal source and drives an output load, the input resistance forms a divider with the source’s resistance, and the output resistance forms a divider with the load, therefore reducing the overall gain from source to load. This reduction is usually referred as loading effect. Negative feedback modifies the terminal resistances in ways that tend to reduce the impact of loading.\n\n6.4.1 Series-shunt (voltage-voltage) feedback configuration - Voltage Amplifier\nLet’s consider the application of negative feedback around a voltage amplifier. In this case feedback is performed sampling the output voltage and then feeding back a voltage that is a scaled version of the output voltage “into” the external input voltage source driving the amplifier. Note that the operation of voltage sensing at the output is performed in parallel, or shunt (when we measure a voltage we place the voltmeter in parallel, never in series), while to combine the external input voltage source and the voltage returned by the feedback network we connect them in series (to connect two voltage sources we place them in series, never in parallel).\nTo focus on the effect of negative feedback on \\(r_i\\) and \\(r_o\\) of the basic amplifier, we assume there is no loading effect on both ports of the basic amplifier. To neglect loading at the input’s of the basic amplifier, we assume that the sources \\(v_{in}\\) and \\(b v_{out}\\) have zero series resistances. To neglect loading at the output port of the basic amplifier, we assume the output port of the basic amplifier is left open and the input port of the feedback network has infinite resistance.\nNote: for the series-shunt feeback configuration, b is unitless.\n\n\n\n\n\n\nFigure 10: The ideal series-shunt configuration or voltage amplifier (Franco 2015)\n\n\n\nIt can be shown:\n\\[\nR_{in} = \\dfrac{v_{x}}{i_{x}} = r_i (1+L)\n\\]\n\\[\nR_{out} = \\dfrac{v_t}{i_t} = \\dfrac{r_o}{1+L}\n\\]\n\n\n\n\n\n\nFigure 11: (a) test circuit for the calculation of the input impedance and (b) test circuit for the calculation of the output impedance\n\n\n\nFor \\(L \\rightarrow \\infty\\) the series-shunt configuration gives \\(R_{in} \\rightarrow \\infty\\) and \\(R_{out} \\rightarrow 0\\)\n\n\n6.4.2 Shunt-shunt (current-voltage) feedback configuration - Transimpedance Amplifier\nLet’s consider the application of negative feedback around a transimpedance amplifier. In this case feedback is performed sampling the output voltage and then feeding back a current that is a scaled version of the output voltage “into” the external input current source driving the amplifier. Note that to combine the external input current source and the current returned by the feedback network we connect them in parallel or shunt (to connect two current sources we place them in parallel, never in series).\nTo neglect loading at the input of the basic amplifier, we assume that the sources \\(i_{in}\\) and \\(b v_{out}\\) have infinite parallel resistances. To neglect loading at the output port of the basic amplifier, we assume the output port of the basic amplifier is left open and the input port of the feedback network has infinite resistance.\nNote: for the shunt-shunt feeback configuration, b has dimensions of \\(1/ \\Omega\\).\n\n\n\n\n\n\nFigure 12: The ideal shunt-shunt configuration or transimpedance amplifier (Franco 2015)\n\n\n\nIt can be shown:\n\\[\nR_{in} = \\dfrac{r_i}{1+L}\n\\]\n\\[\nR_{out} = \\dfrac{r_o}{1+L}\n\\]\nFor \\(L \\rightarrow \\infty\\) the shunt-shunt configuration gives \\(R_{in} \\rightarrow 0\\) and \\(R_{out} \\rightarrow 0\\)\n\n\n6.4.3 Series-series (voltage-current) feedback configuration - Transconductance Amplifier\nLet’s consider the application of negative feedback around a transconductance amplifier. In this case feedback is performed sampling the output current and then feeding back a voltage that is a scaled version of the output current “into” the external input voltage source driving the amplifier. Note that the operation of current sensing at the output is performed in series, or shunt (when we measure a current we place the ampmeter in series, never in parallel).\nTo neglect loading at the input of the basic amplifier, we assume that the sources \\(v_{in}\\) and \\(b i_{out}\\) have zero series resistances. To neglect loading at the output port of the basic amplifier, we assume the output port of the basic amplifier is shorted and the input port of the feedback network has zero resistance.\nNote: for the series-series feedback configuration, b has dimensions of \\(\\Omega\\).\n\n\n\n\n\n\nFigure 13: The ideal series-series configuration or transconductance amplifier (Franco 2015)\n\n\n\nIt can be shown:\n\\[\nR_{in} = r_i (1+L)\n\\]\n\\[\nR_{out} = r_o (1+L)\n\\]\nFor \\(L \\rightarrow \\infty\\) the series-series configuration gives \\(R_{in} \\rightarrow \\infty\\) and \\(R_{out} \\rightarrow \\infty\\)\n\n\n6.4.4 Shunt-series (current-current) feedback configuration - Current Amplifier\nLet’s consider the application of negative feedback around a current amplifier. In this case feedback is performed sampling the output current and then feeding back a current that is a scaled version of the output current “into” the external input current source driving the amplifier.\nTo neglect loading at the input of the basic amplifier, we assume that the sources \\(i_{in}\\) and \\(b i_{out}\\) have infinite parallel resistances. To neglect loading at the output port of the basic amplifier, we assume the output port of the basic amplifier is shorted and the input port of the feedback network has zero resistance.\nNote: for the shunt-series feedback configuration, b is unitless.\n\n\n\n\n\n\nFigure 14: The shunt-series configuration or current amplifier (Franco 2015)\n\n\n\nIt can be shown:\n\\[\nR_{in} = \\dfrac{r_i}{1+L}\n\\]\n\\[\nR_{out} = r_o (1+L)\n\\]\nFor \\(L \\rightarrow \\infty\\) the shunt-series configuration gives \\(R_{in} \\rightarrow 0\\) and \\(R_{out} \\rightarrow \\infty\\)"
  },
  {
    "objectID": "feedback.html#feedback-analysis-of-op-amp-circuits",
    "href": "feedback.html#feedback-analysis-of-op-amp-circuits",
    "title": "Introduction to Feedback",
    "section": "7 Feedback analysis of op amp circuits",
    "text": "7 Feedback analysis of op amp circuits\nIn typical op amp circuits \\(r_i\\) and \\(r_o\\) are negligible compared to the resistances used in the feedback network.\n\n7.1 Non Inverting configuration\n\n\n\n\n\n\n\n\nFigure 15: Block diagram of negative feedback system.\n\n\n\n\n\n\n\n\n\n\n\nFigure 16: Non inverting op amp amplifier (Franco 2015).\n\n\n\nFor identifying \\(a\\) and \\(b\\) directly from the circuit, we can set \\(v_{in} = 0\\) and note that with \\(v_{in}=0\\)\n\\(i_{out} = \\dfrac{v_{out}}{R_2 + R_1 || r_i} = \\dfrac{a_D v_D}{r_o + R_2 + R_1 || r_i}\\)\n\\(v_f = -v_D = i_{out} \\cdot ({R_1 || r_i})\\)\n\\(v_{out} = i_{out} \\cdot \\bigl( {R_2 + R_1 || r_i} \\Bigr)\\)\nSo,\n\\(b = \\dfrac{v_f}{v_{out}} = \\dfrac{R_1 || \\cancel{r_i}}{R_1 || \\cancel{r_i} + R_2} \\approx \\dfrac{R_1}{R_1 + R_2}\\)\n\\(a = \\dfrac{v_{out}}{v_D} = a_D \\cdot \\dfrac{R_2 + R_1 || \\cancel{r_i}}{R_2 + R_1 || \\cancel{r_i} + \\cancel{r_o}} \\approx a_D\\)\nIn practice, for identifying \\(a\\) and \\(b\\), it is better to think directly in terms of loop gain \\(L\\) \\[\nL = ab = - \\frac{v_r}{v_t}\n\\] The minus sign is due to the \\(-\\) at the summing node\n\n\n\n\n\n\n\n\nFigure 17: Breaking the Loop.\n\n\n\n\n\nNote: To find the loop gain, it is best to break the loop at the opamp’s voltage controlled voltage source. This approach preserves all of the node impedances in the circuit.\n\n\n\n\n\n\nFigure 18: Non inverting op amp amplifier with \\(v_{in}\\) nulled and the loop broken at the opamp’s vcvs.\n\n\n\n\\(L = -\\dfrac{v_r}{v_t} = a_D \\cdot \\dfrac{R_1 || \\cancel{r_i}}{R_1 || \\cancel{r_i} +R_2 + \\cancel{r_o}}\\)\n\\(A = A_{ideal} \\dfrac{L}{1+L} \\approx A_{ideal} \\Bigl( 1 - \\dfrac{1}{L} \\Bigr)\\)\n\\(gain \\space error \\approx \\dfrac{A_{ideal} \\Bigl( 1 - \\dfrac{1}{L} \\Bigr) - A_{ideal}}{A_{ideal}} = -\\dfrac{1}{L}\\)\nThe value of \\(A_{ideal}\\) is already known from the ideal op amp analysis\nInfinite opamp gain (\\(a_D \\rightarrow \\infty\\)) implies infinite open-loop gain (\\(a \\approx a_D\\)) and therefore infinite loop gain \\(L=ab\\)\n\\[\nA_{ideal} = \\frac{1}{b} \\approx 1 + \\frac{R_2}{R_1}\n\\]\nExample 4 - non inverting op amp based voltage amplifier\nFor \\(a_D = 10^6\\), \\(r_i = 10 M \\Omega\\), \\(r_o = 10 \\Omega\\), \\(R_1 = 20 k \\Omega\\) and \\(R_2 = 80 k \\Omega\\):\n\\(L = -\\dfrac{v_r}{v_t} = a_D \\cdot \\dfrac{R_1 || \\cancel{r_i}}{R_1 || \\cancel{r_i} +R_2 + \\cancel{r_o}} \\approx 10^6 \\dfrac{20 k\\Omega}{20 k\\Omega + 80 k\\Omega}\\)\nThe exact value of \\(L\\) is 199600, so the above approximation has 0.2% error.\n\\(A = 5 \\cdot \\dfrac{200000}{1+200000} = 4.999975\\)\n\\(gain \\space error \\approx -\\dfrac{1}{200000} = -5 ppm\\)\nThis is the same result as before, except we did not have to go through a tedious nodal analysis and plug in numbers in a “high entropy” espression.\nWhat if the op amp gain changes ?\nIf the gain is cut in half : \\[\nA = 5 \\cdot \\dfrac{100000}{1+100000} = 4.999950\n\\] If the gain doubles: \\[\nA = 5 \\cdot \\dfrac{400000}{1+400000} = 4.999988\n\\]\n\nThe closed loop gain (\\(A\\)) is immune to large variations in the op amp gain\nThe voltage gain of the overall circuit (= closed loop gain) is primarily defined by the divider ratio of the resistive feedback\n\nA quantity that we can control very precisely\n\n\n\n\n7.2 Inverting configuration\nIn this configuration the resistors affect both the input and the feedback path.\n\n\n\n\n\n\nFigure 19: Inverting op amp amplifier. (Franco 2015})\n\n\n\nIt is not clear how to map the circuit into the block diagram representation. The flow of the signal through the circuit elements is not unidirectional.\n\n\n\n\n\n\n\n\nFigure 20: Block diagram of negative feedback system.\n\n\n\n\n\nWe can still try to make things work using superposition.\n\n\n\n\n\n\n\n\nFigure 21: Breaking the loop (\\(v_f=0\\))\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 22: Breaking the loop (\\(v_{in}=0\\))\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 23: op amp based inverting amplifier with break in the loop (\\(v_f = 0\\))\n\n\n\n\n\n\\[\na = \\frac{v_{out}}{v_{in}} = - \\dfrac{R_2}{R_1 + R_2} \\cdot a_D\n\\]\n\n\n\n\n\n\n\n\nFigure 24: op amp based inverting amplifier with break in the loop (\\(v_{in} = 0\\))\n\n\n\n\n\n\\[\n-ab = \\frac{v_{out}}{v_{test}} = - \\dfrac{R_1}{R_1 + R_2} \\cdot a_D\n\\]\nNote: the loop gain is the same as the one of the non-inverting configuration.\n\\[\nA_{ideal} = \\dfrac{1}{b} = \\dfrac{a}{ab} = - \\dfrac{R_2}{R_1}\n\\]\nBeyond \\(A_{ideal}\\) the only other value we need to know is the loop gain \\(L=ab\\) so we can compute the deviation from ideality\n\n\n7.3 Comparison between non-inverting and inverting topology\n\n\n\n\n\n\n\n\nFigure 25: comparison between inverting and non-inverting topology\n\n\n\n\n\nThe following model is valid for both topologies:\n\n\n\n\n\n\n\n\nFigure 26: Block diagram model valid for both topologies.\n\n\n\n\n\nIn summary op amp circuits can be analyzed as follows:\n\nFind \\(A_{ideal}\\) using nodal analysis, assuming infinite op amp gain\nFind the loop gain to compute the deviation from the ideal case\n\nThis is usually straight forward, especially when there are ideal breakpoints that do not alter the impedance loading around the loop\nThe best breakpoint for a voltage amplifier is right at the controlled voltage source\n\n\n\\[\nA = \\dfrac{v_{out}}{v_{in}} = A_{ideal} \\cdot \\dfrac{L}{L+1} = A_{ideal} \\cdot \\dfrac{1}{1+\\dfrac{1}{L}}\n\\]\n\n\n7.4 The four feedback configurations using op amps\nSometimes the operations of output sensing and input returning are not obvious. Even though strictly speaking the op amp is a voltage amplifier, it can be used in any of the four feedback configurations.\n\n7.4.1 Series-Shunt (voltage-voltage) configuration (Voltage Amplifier)\n\n\n\n\n\n\nFigure 27: Series-shunt configuration: \\(b = \\dfrac{v_f}{v_{out}} = \\dfrac{R_1}{R_1 + R_2}\\)\n\n\n\nFor \\(a_v \\rightarrow \\infty\\) this circuit gives:\n\\(A_v = \\dfrac{v_{out}}{v_{in}} = \\dfrac{1}{b} = 1 + \\dfrac{R_2}{R_1}\\)\n\\(R_{in} \\rightarrow \\infty\\)\n\\(R_{out} \\rightarrow 0\\)\nThis circuit is the popular non inverting op amp based voltage amplifier.\n\n\n7.4.2 Shunt-Shunt (current-voltage) configuration (Transimpedance Amplifier)\n\n\n\n\n\n\nFigure 28: Shunt-shunt configuration: \\(b = \\dfrac{i_f}{v_{out}} = -\\dfrac{1}{R}\\)\n\n\n\nFor \\(a_v \\rightarrow \\infty\\) this circuit (= TIA) gives:\n\\(R_m = \\dfrac{v_{out}}{i_{in}} = \\dfrac{1}{b} = -R\\)\n\\(R_{in} \\rightarrow 0\\)\n\\(R_{out} \\rightarrow 0\\)\nEven though the shunt-shunt configuration is a TIA, it forms the basis of the popular inverting op amp based voltage amplifier.\n\n\n\n\n\n\nFigure 29: inverting op amp based voltage amplifier\n\n\n\n\n\n\n\n\n\nFigure 30: inverting op amp based voltage amplifier with the input voltage source transformed into a current source\n\n\n\nThis becomes more evident if we perform a source transformation to convert the voltage source \\(v_{in}\\) in Figure 29 into a current source \\(i_{in} = \\dfrac{v_{in}}{R_1}\\) as shown in Figure 30.\nFor the inverting voltage amplifier as \\(a_v \\rightarrow \\infty\\)\n\\(A_v = \\dfrac{v_{out}}{v_{in}} = \\dfrac{v_{out}}{i_{in}} \\times \\dfrac{i_{in}}{v_{in}} = -\\dfrac{R_2}{R_1}\\)\n\\(R_{in} = R_1\\)\n\\(R_{out} \\rightarrow 0\\)\n\n\n7.4.3 Series-Series (voltage-current) configuration (Transconductance Amplifier)\n\n\n\n\n\n\nFigure 31: series-series configuration: \\(b = \\dfrac{v_f}{i_{out}} = {R}\\)\n\n\n\nFor \\(a_v \\rightarrow \\infty\\)\n\\(G_m = \\dfrac{i_{out}}{v_{in}} = \\dfrac{1}{b} = \\dfrac{1}{R}\\)\n\\(R_{in} \\rightarrow \\infty\\)\n\\(R_{out} \\rightarrow \\infty\\)\n\n\n7.4.4 Shunt-Series (current-current) configuration (Current Amplifier)\n\n\n\n\n\n\nFigure 32: shunt-series configuration: \\(b = \\dfrac{i_f}{i_{out}} = -\\dfrac{R_1}{R_1+R_2} =-\\dfrac{1}{1+ R_2/R_1}\\)\n\n\n\nFor \\(a_v \\rightarrow \\infty\\)\n\\(A_i = \\dfrac{i_{out}}{i_{in}} = \\dfrac{1}{b} = -(1 + \\dfrac{R_2}{R_1})\\)\n\\(R_{in} \\rightarrow 0\\)\n\\(R_{out} \\rightarrow \\infty\\)"
  },
  {
    "objectID": "feedback.html#return-ratio-analysis",
    "href": "feedback.html#return-ratio-analysis",
    "title": "Introduction to Feedback",
    "section": "8 Return Ratio Analysis",
    "text": "8 Return Ratio Analysis\n\n8.1 Closed-loop gain using return ratio\nGiven a feedback amplifier, with a controlled source of value k (see Figure 33), the closed loop gain can be derived as shown in (Gray et al. 2009): \\[\nA = \\dfrac{s_{out}}{s_{in}} = A_\\infty \\cdot \\dfrac{T}{1+T} + \\dfrac{d}{1+T}\n\\]\n\n\n\n\n\n\n\n\nFigure 33: Feedback amplifier: return ratio framework to derive the closed-loop gain\n\n\n\n\n\nVisually, the expression for the closed loop gain can be summarized through the block diagram in Figure 34: \\[\n\\left(s_{in} - \\dfrac{s_{out}}{A_\\infty}\\right) \\cdot T A_\\infty + d \\cdot s_{in} = s_{out}\n\\] \\[\nA = \\dfrac{s_{out}}{s_{in}} = A_\\infty \\cdot \\dfrac{T}{1+T} + \\dfrac{d}{1+T}\n\\]\n\n\n\n\n\n\n\n\nFigure 34: Block diagram for closed-loop gain using return ratio framework\n\n\n\n\n\nThe three terms needed to find the closed loop gain (\\(A_\\infty\\), \\(T\\), \\(d\\)) are all directly computable and measurable (SPICE), and do not rely on any idealization of the feedback network.\nIn practical circuits the feedback network loads both the input and output of the amplifier, so idealizing its effect is not realistic. With two-port analysis incorporating the effect of loading without the use of suitable approximations/idealizations of the feedback network becomes extremely tedious.\nThe return ratio analysis does not try to identify the transfer function of the basic amplifier and the feedback network separately. It aims to identify directly the gain around the feedback loop. From the loop gain of a circuit, we can determine:\n\nstability\nclosed-loop gain\nnodal impedances\n\nThe return ratio analysis can be applied to any arbitrary feedback circuit, independent of topology and port structure.\nThe return ratio for a dependent source in a feedback loop is found as follows:\n\nSet all independent sources to zero\nIdentify a dependent source in the feedback loop that you want to analyze and break the loop by disconnecting the dependent source from the rest of the circuit. Leave the dependent source open-circuited if it is of the voltage type, or short-circuited if it is of the current-type\nOn the side of the break that is not connected to the dependent source, inject an independent test source \\(s_t\\) of the same sign and type as the dependent source\nFind the return signal \\(s_r\\), generated at the controlled source that was disconnected\nThe return ratio \\(T\\) for the dependent source is \\(T=-s_r/s_t\\)\n\nProvided that we have chosen a controlled source that breaks the loop globally, the return ratio of the dependent source is equal to the loop gain of the circuit.\nFor the stabilty analysis of a feedback circuit we must have the loop gain not just any return ratio. Unless, we have a single loop feedback circuit, the return ratios computed for different dependent sources are not necessarily equal (Hurst 1991), so in general, the return ratio is not a global property of the loop (Hajimiri 2023).\n\n\nThe direct feedthrough \\(d\\) is given by:\n\\[\nd = \\dfrac{s_{out}}{s_{in}} |_{k = 0}\n\\]\nwhich is the transfer function from input to output evaluated for k = 0. In other words, the direct feedthrough \\(d\\) is the signal transfer from input to output through the passive elements, it represent a signal path from input to output that goes around rather than through the controlled source k.\nThe value of \\(A_\\infty\\) is the closed loop gain when the feedback circuit is ideal (that is when \\(T \\rightarrow \\infty\\)). If \\(T \\rightarrow \\infty\\) then \\(A = A_\\infty\\), because \\(\\dfrac{T}{1+T} \\rightarrow 1\\) and \\(\\dfrac{d}{1+T} \\rightarrow 0\\)\nSince letting \\(k \\rightarrow \\infty\\) causes \\(T \\rightarrow \\infty\\) (Gray et al. 2009) the value of \\(A_\\infty\\) can be easily found by evaluating \\[\n\\dfrac{s_{out}}{s_{in}} |_{k \\rightarrow \\infty}\n\\]\nWhen \\(k \\rightarrow \\infty\\), the controlling signal \\(s_{ic}\\) for the dependent source must be zero for the output of the controlled source to be finite. The controlled source output will be finite if the feedback is negative.\nThe key difference between the return ratio analysis and the two-port analysis can be seen comparing Figure 34 and Figure 35 In the two-port analysis all forward signal transmission is lumped in the block \\(a\\). In the return ratio analysis, there are two forward signal paths: one path (\\(d\\)) for the feedback network and another path (\\(TA_\\infty\\)) for the forward gain.\n\n\n\n\n\n\n\n\nFigure 35: Block diagram model for closed-loop gain using the two-port framework\n\n\n\n\n\nExample 5 - common source stage with current source biasing\nConsider the circuit in Figure 36 and its AC equivalent model in Figure 37\n\n\n\n\n\n\n\n\nFigure 36: Common source with current-source biasing\n\n\n\n\n\nCurrent source biasing in this circuit doesn’t work without feedback setting the drain voltage.\nGiven the finite gain and the nature of the impedances of the MOS, in this circuit is hard to decouple a(s) and b(s), so using the two-port analysis is not a good option. \\[\nA(s) =  \\dfrac{a(s)}{1+a(s)b(s)}\n\\]\nIn this case, since the circuit is not very complex we can use exact nodal analysis.\n\n\n\n\n\n\n\n\nFigure 37: AC equivalent model of the feedback circuit in Figure 36\n\n\n\n\n\n\\[\n\\dfrac{v_{in}-v_x}{R_1} + \\dfrac{v_{out}-v_x}{R_2} = 0\\Leftrightarrow \\dfrac{v_{in}}{R_1} - \\left( \\dfrac{1}{R_1} + \\dfrac{1}{R_2} \\right) \\cdot v_x + \\dfrac{v_{out}}{R_2}=0\n\\tag{7}\\] \\[\n\\dfrac{v_x-v_{out}}{R_2} = g_m v_x \\Leftrightarrow v_x=\\dfrac{v_{out}}{1-g_m R_2}\n\\tag{8}\\]\nSubstituting Equation 7 in Equation 8: \\[\n\\dfrac{v_{out}}{v_{in}} = \\dfrac{1 - g_m R_2}{1+g_m R_1} = - \\dfrac{R_2}{R_1} \\left( \\dfrac{1-\\dfrac{1}{g_m R_2}}{1+\\dfrac{1}{g_m R_1}} \\right)\n\\]\nIf the \\(g_m R\\) terms are much greater than 1, the result is the same as the op amp solution.\nLet’s now confirm that return ratio analysis produces the same result.\nReturn ratio calculation\n\n\n\n\n\n\n\n\nFigure 38: return ratio calculation\n\n\n\n\n\n\\(v_{gs} = - R_1 i_t\\)\n\\(i_r = g_m v_{gs} = - g_m R_1 i_t\\)\n\\(\\dfrac{i_r}{i_t} = - g_m R_1\\)\n\\(T \\equiv - \\dfrac{i_r}{i_t} = g_m R_1\\)\nIdeal closed loop gain calculation\n\\(A_\\infty\\) is the transfer function when the gain element of the controlled source becomes \\(\\infty\\). In our case this corresponds to \\(g_m \\rightarrow \\infty\\). If the gain element becomes \\(\\infty\\) the controlling signal must be zero. In our case this correspond to the input node \\(v_{gs}=0\\), therefore:\n\n\n\n\n\n\n\n\nFigure 39: Ideal closed loop gain calculation\n\n\n\n\n\n\\(\\dfrac{v_{in}}{R_1}=-\\dfrac{v_{out}}{R_2} \\Leftrightarrow A_\\infty = \\dfrac{v_{out}}{v_{in}} = - \\dfrac{R_2}{R_1}\\)\nDirect feedtrough (d) calculation\n\n\n\n\n\n\n\n\nFigure 40: Direct feedthrough calculation\n\n\n\n\n\n\\(d\\) is defined as the transfer function when the gain element becomes zero. In our case for \\(g_m = 0\\)\n\\(v_{out} = v_{in} \\Leftrightarrow d = \\dfrac{v_{out}}{v_{in}} = 1\\)\nIn summary:\n\n\\(T = g_m R_1\\)\n\\(A_\\infty = - \\dfrac{R_2}{R_1}\\)\n\\(d = 1\\)\n\nTherefore, as expected the closed loop gain computed using the return ratio framework matches with the result obtained using exact nodal analysis:\n\\[\n\\begin{split}\nA &= A_\\infty \\cdot \\dfrac{T}{1+T} + \\dfrac{d}{1+T} \\\\\n&= - \\dfrac{R_2}{R_1} \\cdot \\dfrac{g_m R_1}{1+g_m R_1} + \\dfrac{1}{1+g_m R_1} \\\\\n&= \\dfrac{1 - g_m R_2}{1 + g_m R_1}\n\\end{split}\n\\]\nExample 6 - constant-\\(g_m\\) reference\nIn this example, we will use the return ratio framework to evaluate the stability of the bias circuit in Figure 41. The bias circuit in Figure 41 is know as constant-\\(g_m\\) reference or \\(\\Delta V_{GS}\\) reference.\nNote: this circuit has only one-port so it cannot be analyzed using the two-ports framework.\n\n\n\n\n\n\n\n\nFigure 41: Constant-\\(g_m\\) reference\n\n\n\n\n\n\\[\n\\begin{split}\nI_{REF} \\cdot R_2 &= V_{GS1} - V_{GS2} = V_{OV1} - V_{OV2} \\\\\n&\\approx V_{OV1} \\left( 1 - \\dfrac{1}{\\sqrt{m}} \\right)\n\\end{split}\n\\]\n\\[\nI_{REF} \\approx \\dfrac{V_{OV1} \\left( 1 - \\dfrac{1}{\\sqrt{m}} \\right)}{R_2}\n\\]\n\nThis circuit has positive feedback.\nA positive feedback system is stable only if its loop gain is less than 1 (\\(T &lt; 1\\))\n\n\n\n\n\n\n\n\n\nFigure 42: AC equivalent model of the constant-\\(g_m\\) bias circuit\n\n\n\n\n\nTo identify which dependent source to use for computing the loop gain \\(T\\) of the circuit, the feedback loop we break must be global.\n\n\\(M_2\\) and \\(R_2\\) degeneration, form a local feedback loop, so \\(M_2\\) cannot be used to break the main loop\n\\(M_1\\) and \\(M_4\\) are diode-connected; their transcondactance elements are equivalent to a resistance \\(1/g_m\\), so cannot be used to break the main loop\n\\(M_3\\) is the only “normal” CS gain stage in the circuit, so it is the only element that can be used to break the main loop\n\nIn general, the return ratio of CG, CD, or degenerated CS cannot be used to find the “global” loop gain of a circuit.\nTo compute the loop gain \\(T\\) of the circuit, it is convenient to first unroll and linearize the AC equivalent model in Figure 42:\n\n\n\n\n\n\n\n\nFigure 43: Unrolled AC equivalent model for the constant-\\(g_m\\) bias circuit\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 44: Small signal equivalent model for the constant-\\(g_m\\) bias circuit, (a) red: circuit features that make \\(s_t\\) insertion not possible, (b) blue: best place for \\(s_t\\) insertion\n\n\n\n\n\nand then insert the test source:\n\n\n\n\n\n\n\n\nFigure 45: Computing the return ratio for the constant-\\(g_m\\) bias circuit\n\n\n\n\n\n\\(i_r = g_{m3}v_4\\)\n\\(i_t = - g_{m1}v_1\\)\n\\(v_4 = -i_2 \\left( 1/ g_{m4}\\right)\\)\n\\(i_2 = g_{m2} v_2\\)\n\\(v_1 = v_2 + g_{m2}v_2 R_2 \\Leftrightarrow v_2 = \\dfrac{v_1}{\\left( 1+g_{m2}R_2 \\right)}\\)\nPutting the pieces together:\n\\(\\dfrac{i_r}{i_t}= \\left(-\\dfrac{g_{m3}}{g_{m1}}\\right) \\left(- \\dfrac{g_{m2}}{g_{m4}}\\right) \\left(\\dfrac{1}{1+g_{m2}R_2}\\right)\\)\nTherefore: \\(T = -\\dfrac{i_r}{i_t}= -\\left(\\dfrac{g_{m3}}{g_{m1}}\\right) \\left(\\dfrac{g_{m2}}{g_{m4}}\\right) \\left(\\dfrac{1}{1+g_{m2}R_2}\\right)\\)\nThe resulting return ratio is negative (i.e. the feedback is definitely not negative, even at zero frequency). The challange is to keep the magnitude of the return ratio less than unity (\\(|T| &lt; 1\\)).\nThe loop has two inverting gain blocks, each loaded with a “diode connected” MOS device. The gain block formed by \\(M_3\\) is loaded by the diode connected MOS \\(M_1\\) and the gain block formed by \\(M_2\\) and \\(R_2\\) is loaded by the diode connected MOS \\(M_4\\).\n\n\n\n\n\n\n\n\nFigure 46: Small signal equivalent model for the constant-\\(g_m\\) bias circuit\n\n\n\n\n\nExample 7 - potential stability issue of the constant-\\(g_m\\) reference\nConsider the design of the constant-\\(g_m\\) reference circuit in Figure 47:\nAssume: \\(I(M_3)=I(M_4)=I_{REFN}=100 μA\\)\n\\(V_{OV1} = 200 mV\\)\n\\(m=2\\)\n\n\n\n\n\n\n\n\nFigure 47: Constant-\\(g_m\\) reference: design example\n\n\n\n\n\nFor the given circuit:\n\\(g_{m4}=g_{m3} = g_{m1} = \\dfrac{2 \\cdot 100 μA}{200 mV} = 1 mS\\)\nRecalling that (assuming square law):\n\\(V_{OV2} = \\dfrac{V_{OV1}}{\\sqrt{m}}\\)\n\\(I_{REF} = \\dfrac{V_{OV1} \\left( 1- \\dfrac{1}{\\sqrt{m}} \\right)}{R_2}\\)\nfor m=2:\n\\(V_{OV2} = 141 \\space mV\\)\n\\(R_2 = 586 \\space \\Omega\\)\n\\(g_{m2}=\\dfrac{2 \\cdot 100 μA}{141 mV} = 1.41 \\space mS\\)\n\\(\\dfrac{g_{m2}}{1+g_{m2}R_2} = 772 \\space μS\\)\nThe magnitude of the return ratio is less than 1:\n\\(|T| = \\dfrac{i_r}{i_t} = \\left( \\dfrac{g_{m2}}{1+g_{m2}R_2} \\right) \\left(\\dfrac{1}{g_{m4}} \\right) \\left( \\dfrac{\\cancel{g_{m3}}}{\\cancel{g_{m1}}} \\right)= 0.772 \\space (&lt; 1)\\)\nTherefore, the circuit designed is stable, but is possible to have problems. Consider, Figure 48, if the parasitic capacitance \\(C\\) shorts \\(R_2\\), the return ratio becomes larger than 1 and the circuit becomes unstable.\n\\(\\dfrac{i_r}{i_t} = \\left( \\cancelto{1}{\\dfrac{1}{1+g_{m2}R_2}} \\right) \\left(\\dfrac{g_{m2}}{g_{m4}} \\right) \\left( \\dfrac{\\cancel{g_{m3}}}{\\cancel{g_{m1}}} \\right) \\rightarrow 1.41\\)\n\n\n\n\n\n\n\n\nFigure 48: Constant-\\(g_m\\) reference: possible problem\n\n\n\n\n\n\n\n8.2 Closed-loop impedances using return ratio\nFeedback can be used to modify the port impedances of a circuit.\nGiven a feedback circuit with a controlled source of value k (see Figure 49), the impedance at any port, including the input and output ports, can be computed (Gray et al. 2009) using the following expression (a.k.a. Blackman’s formula):\n\\[\nZ_{port} = Z_{port}(k=0) \\cdot \\left[ \\dfrac{1+T(port \\space shorted)}{1+T(port \\space open)} \\right]\n\\]\n\n\\(Z_{port}(k=0)\\) is the port impedance with the return ratio’s gain element k set to 0 (either set \\(g_m=0\\) or \\(a_v =0\\))\n\\(T(port \\space shorted)\\) is the return ratio with the port under consideration shorted\n\\(T(port \\space open)\\) is the return ratio with the port under consideration open\n\nOften, one of the two return ratios in the formula is zero, in these cases feedback increases or decreases the impedance by a factor \\((1+T)\\)\n\n\n\n\n\n\n\n\nFigure 49: Feedback circuit to derive Blackman’s formula with respect to port x\n\n\n\n\n\nIn summary, Blackman’s impedance formula:\n\nit applies to any feedback circuit, regardless of the type of feedback\nit is extremely useful and easy to use\nit is based on return ratio calculations\n\nExample 8 - Input resistance of non-inverting op amp configuration\n\n\n\n\n\n\n\n\nFigure 50: Input resistance of non-inverting op amp circuit\n\n\n\n\n\n\\[\nR_{in} = R_{in0} \\cdot \\left[ \\dfrac{1+T(port \\space shorted)}{1+T(port \\space open)} \\right]\n\\]\n\nTo find \\(R_{in0}\\) set the op amp gain \\(a_v\\) to zero: \\[\nR_{in0} = r_i + R_1 || (R_2 + r_o|| R_L) \\approx r_i\n\\]\nTo compute \\(T(port \\space shorted)\\) short the node \\(v_p\\) to ground and find the return ratio:\n\n\n\n\n\n\n\n\n\nFigure 51: T(with input port shorted) for non inverting configuration\n\n\n\n\n\n\\[\nT_{sc} = -\\dfrac{v_r}{v_t} |_{sc} = a_v \\cdot \\dfrac{R_1}{r_o + R_L|| (R_2 + r_i || R_1) } \\approx a_v \\cdot \\dfrac{R_1}{R_1+R_2}\n\\]\n\nTo compute \\(T(port \\space open)\\) leave the node \\(v_p\\) floating and find the return ratio:\n\n\n\n\n\n\n\n\n\nFigure 52: T(with input port open) for non inverting configuration\n\n\n\n\n\n\\[\nT_{open} = -\\dfrac{v_r}{v_t} |_{open} = 0\n\\]\nFeedback increases the input impedance of the circuit significantly. \\[\nR_{in} \\approx r_i \\cdot \\dfrac{1+ a_v \\cdot \\dfrac{R_1}{R_1+R_2}}{1+0} = r_i \\cdot \\left( 1+ a_v \\cdot \\dfrac{R_1}{R_1+R_2} \\right)\n\\]\nFor \\(a_v=10^6\\), \\(R_1 = 20 k\\Omega\\), \\(R_2 = 80k\\Omega\\):\n\\[\nR_{in} \\approx r_i \\cdot 200000\n\\]\nExample 9 - Output resistance of non-inverting op amp configuration\n\n\n\n\n\n\n\n\nFigure 53: Output resistance of non-inverting op amp circuit\n\n\n\n\n\n\\[\nR_{out} = R_{out0} \\cdot \\left[ \\dfrac{1+T(port \\space shorted)}{1+T(port \\space open)} \\right]\n\\]\n\nTo find \\(R_{out0}\\) set the op amp gain \\(a_v\\) to zero: \\[\nR_{out0} = r_o || [R_2 + R_1 || (r_i + R_s)] \\approx r_o\n\\]\nTo compute \\(T(port \\space shorted)\\) short the node \\(v_{out}\\) to ground and find the return ratio:\n\n\n\n\n\n\n\n\n\nFigure 54: T(with output port shorted) for non-inverting configuration\n\n\n\n\n\n\\[\nT_{sc} = -\\dfrac{v_r}{v_t} |_{sc} = 0\n\\]\n\nTo compute \\(T(port \\space open)\\) leave the node \\(v_{out}\\) floating and find the return ratio:\n\n\n\n\n\n\n\n\n\nFigure 55: T(with output port open) for non-inverting configuration\n\n\n\n\n\n\\[\nv_n = \\dfrac{v_t}{r_o + R_2 + [R_1 || (r_i + R_s)]} \\cdot {R_1 || (r_i + R_s)} \\approx \\dfrac{v_t}{R_2 + R_1} \\cdot R_1\n\\]\n\\[\nv_p = v_n \\dfrac{R_s}{r_i + R_s} \\approx 0\n\\]\n\\[\nT_{open} = -\\dfrac{v_r}{v_t} |_{open} = - \\dfrac{a_v (v_p - v_n)}{v_t} \\approx a_v \\cdot \\dfrac{R_1}{R_1+R_2}\n\\]\nFeedback decreases the output impedance of the circuit significantly.\n\\[\nR_{out} \\approx r_o \\cdot \\dfrac{1+0}{1+a_v \\dfrac{R_1}{R_1+R_2}} = \\dfrac{r_o}{1+a_v \\dfrac{R_1}{R_1+R_2}}\n\\]\nFor \\(a_v=10^6\\), \\(R_1 = 20 k\\Omega\\), \\(R_2 = 80k\\Omega\\):\n\\[\nR_{out} \\approx \\dfrac{r_o}{200000}\n\\]\nExample 10 - Output resistance of bootstrapped source follower\nConsider the bootstrapped source follower stage of Figure 56 and its equivalent small signal circuit to compute the return ratio with the output port shorted (Figure 57) and with the output port left floating (Figure 58)\n\n\n\n\n\n\n\n\nFigure 56: A bootstrapped source follower stage\n\n\n\n\n\nThe output resistance for \\(k=a_v=0\\) is:\n\\[\nR_{out0} \\equiv R_{out}(k=0) \\equiv R_{out}(a_v=0) = \\dfrac{1}{g_m}\n\\]\n\n\n\n\n\n\n\n\nFigure 57: Finding T(with output port shorted), \\(-v_d=v_{out}=0\\)\n\n\n\n\n\nOutput port shorted implies:\n\\(T_{sc} = -\\frac{v_r}{v_t} |_{sc} = 0\\)\n\n\n\n\n\n\n\n\nFigure 58: Finding T(with output port open), \\(v_{out}=-v_d=-v_{gs} + v_t\\)\n\n\n\n\n\nOutput port open means:\n\\(g_m \\cdot v_{gs} = 0 \\rightarrow v_{gs}=0 \\rightarrow -v_d = v_t \\rightarrow v_r = -a_v \\cdot v_t\\)\n\\(T_{open} = -\\frac{v_r}{v_t} |_{open} = a_v\\)\nTherefore, the closed-loop output resistance is: \\[\nR_{out} = R_{out0} \\cdot \\dfrac{1 + T_{sc}}{1+T_{open}} = \\dfrac{1}{g_m} \\cdot \\left( \\dfrac{1}{1+a_v}\\right)\n\\]\nExample 11 - Output resistance of super source follower\nThe super-source follower uses feedback to reduce its output impedance.\n\n\n\n\n\n\n\n\nFigure 59: Super-source follower stage\n\n\n\n\n\nThe small signal model of the super-source follower is shown in Figure 60.\n\n\n\n\n\n\n\n\nFigure 60: Small-signal model of the super-source follower\n\n\n\n\n\n\nTo find \\(R_{out0}\\) we must set \\(v_{in}=0\\) and \\(k=0\\). In this circuit we can use, either \\(g_{m1}\\) or \\(g_{m2}\\) as k. We will use, \\(k=g_{m2}\\).\n\nThe current in the \\(g_{m1}\\) generator flows only in \\(r_{o1}\\), so \\(M_1\\) has no effect on the output resistance when \\(g_{m2}=0\\)\n\\[\nR_{out0} \\equiv R_{out}(g_{m2}=0) = r_{o2}\n\\]\n\nThe return ratio for \\(g_{m2}\\) with the output port shorted is:\n\n\\[\nT_{sc} = -\\dfrac{i_r}{i_t} |_{sc} = 0\n\\]\n\n\n\n\n\n\n\n\nFigure 61: Return Ratio for \\(g_{m2}\\) with the output port shorted\n\n\n\n\n\nShorting the output port forces \\(v_{out}=0\\)\n\\(v_{out} \\equiv v_x \\Leftrightarrow v_x = 0\\)\n\\(v_x = -v_1 \\leftrightarrow v_1 = 0\\)\n\\(g_{m1} \\cdot v_1=0 \\Leftrightarrow v_y = 0\\)\n\\(v_2 = x_x - v_y = 0 \\Leftarrow g_{m2}v_2 \\equiv i_r = 0\\)\n\nThe return ratio for \\(g_{m2}\\) with the output port open is:\n\n\\[\nT_{open} = -\\dfrac{i_r}{i_t} |_{open} = g_{m2}r_{o2} \\left( 1 + g_{m1}r_{o1}\\right)\n\\]\n\n\n\n\n\n\n\n\nFigure 62: Return Ratio for \\(g_{m2}\\) with the output port open\n\n\n\n\n\nOpening the output port gives:\n\\(v_x = -i_t \\cdot r_{o2} \\Leftrightarrow i_t = - \\dfrac{v_x}{r_{o2}}\\)\n\\(v_x = -v_1\\)\n\\(v_y - v_x = -g_{m1} \\cdot v_1 \\cdot r_{o1} \\Leftrightarrow v_y = v_x +  g_{m1} \\cdot r_{o1} \\cdot v_x \\Leftrightarrow v_y = v_x \\left(1+g_{m1}r_{o1} \\right)\\)\n\\(v_2 = v_y\\)\n\\(i_r \\equiv g_{m2}v_2 = g_{m2} \\left( 1 + g_{m1} \\cdot r_{o1} \\right) \\cdot v_x\\)\n\\(T_{open} = - \\dfrac{i_r}{i_t} = g_{m2}r_{o2} \\left( 1 + g_{m1}r_{o1}\\right)\\)\n\nThe closed-loop output resistance is:\n\n\\[\nR_{out} = R_{out0} \\cdot \\dfrac{1+ T_{sc}}{1+T_{open}} = \\dfrac{r_{o2}}{1 + g_{m2}r_{o2} \\left( 1 + g_{m1}r_{o1}\\right) }\n\\]\nAssuming \\(g_m r_o \\gg 1\\)\n\\[\nR_{out} \\approx \\dfrac{1}{g_{m1}g_{m2}r_{o1}}\n\\]\nExample 12 - Input and output resistance of shunt-shunt stage (TIA)\n\n\n\n\n\n\n\n\nFigure 63: Shunt-shunt stage (Transimpedance Amplifier)\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 64: Small signal model of the shunt-shunt stage\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 65: Small signal model to find the return ratio for \\(g_{m}\\)\n\n\n\n\n\n\nClosed-loop input resistance\n\n\\(R_{in}(g_{m}=0) = R_F + r_o\\)\n\\(T(input \\space shorted) = 0\\)\n\\(T(input \\space open) = g_m r_o\\)\nTherefore, the closed-loop input resistance is: \\[\nR_{in} = \\left(R_F + r_o \\right) \\cdot \\dfrac{1}{1+g_mr_o} \\approx \\dfrac{1}{g_m} \\left( 1 + \\dfrac{R_F}{r_o}\\right)\n\\]\n\nClosed-loop output resistance\n\n\\(R_{out}(g_{m}=0) = r_o\\)\n\\(T(input \\space shorted) = 0\\)\n\\(T(input \\space open) = g_m r_o\\)\nTherefore, the closed-loop output resistance is: \\[\nR_{out} = r_o \\cdot \\dfrac{1}{1+g_mr_o} \\approx \\dfrac{1}{g_m}\n\\]\nExample 13 - Output resistance of active cascode\nThe “active cascode” circuit is also referred as “regulated cascode” or “gain-boosting” technique.\n\n\n\n\n\n\n\n\nFigure 66: Active cascode gain stage\n\n\n\n\n\n\nTo find \\(R_{out0}\\) we set \\(v_{in}=0\\) and \\(k=a_v=0\\)\n\nWith \\(a_v=0\\) the gate of \\(M_2\\) gets grounded:\n\\[\n\\begin{split}\n& R_{out0} \\equiv R_{out}(a_v=0) = r_{o1} + r_{o2} \\left( 1 + g_{m2}' \\right) \\approx r_{o1} \\cdot r_{o2} \\cdot g'_{m2} \\\\\n& with \\space g_{m2}' = g_{m2} + g_{m2b}\n\\end{split}\n\\]\n\nTo find the return ratio for \\(a_v\\) with the output port open, we set \\(v_{in}=0\\) and leave the output node floating\n\nThe current of the \\(g_{m}\\)-generators (\\(g_{m2} v_{gs2}\\) and \\(g_{mb2} v_{bs2}\\)) flows only in \\(r_{o1}\\), changing the drain voltage of \\(M_2,\\) but keeping the source voltage of \\(M_2\\) to \\(v_x=0 \\Rightarrow v_d=-v_x=0\\). Therefore, \\(v_r = a_v \\cdot v_d = 0\\)\n\n\n\n\n\n\n\n\nFigure 67: Return ratio for \\(a_v\\) with the output port open\n\n\n\n\n\n\\[\nT_{open} = - \\dfrac{v_r}{v_t} |_{open} = 0\n\\]\n\nTo find the return ratio for \\(a_v\\) with the output port shorted, we set \\(v_{in}=0\\) and ground the output node (the output node is the drain of \\(M_2\\))\n\n\n\n\n\n\n\n\n\nFigure 68: Return ratio for \\(a_v\\) with the output port shorted\n\n\n\n\n\nWith \\(M_2\\) drain to ground (CD), \\(v_x=-v_d\\) is the output of a CD with \\(v_t\\) as input.\n\\(v_t=v_{gs2} - v_d\\)\nNeglecting the \\(r_o\\) terms w.r.t. the \\(1/g_{mb2}\\) term:\n\\(-v_d \\approx \\dfrac{g_{m2} v_{gs2}}{g_{mb2}} \\Rightarrow v_t \\approx v_{gs2} \\left( 1 + \\dfrac{g_{m2}}{g_{mb2}}\\right) \\Rightarrow -\\dfrac{v_d}{v_t} \\approx \\dfrac{g_{m2}}{g_{m2}+g_{mb2}} \\approx 1\\)\nso the return ratio is: \\[\nT_{sc} = - \\dfrac{v_r}{v_t} |_{sc} \\approx a_v \\cdot \\dfrac{g_{m2}}{g_{m2}+g_{mb2}} \\approx a_v\n\\]\n\nThe closed-loop output resistance is:\n\n\\[\nR_{out} = R_{out0} \\cdot \\dfrac{1 + T_{sc}}{1+T_{open}} \\approx r_{o1} \\cdot r_{o2} \\cdot g'_{m2} \\cdot a_v\n\\]\nExample 14 - Using Blackman’s formula for ZVTC calculations\n\n\n\n\n\n\n\n\nFigure 69: ZVTC calculations\n\n\n\n\n\nUsing first principles (KVL and KCL) we can derive that:\n\\[\n\\tau_{Cgs} = C_{gs} \\cdot \\dfrac{R_i + R_G}{1+g_{m}R_i}\n\\]\n\n\n\n\n\n\n\n\nFigure 70: Small signal model for ZVTC calculations, assuming \\(r_o\\) can be ignored\n\n\n\n\n\nLet’s look at the problem, using return ratio.\nThe port (gate-source) impedance with the return ratio’s gain element \\(g_m\\) set to 0 is:\n\\(R_{gs}(g_m=0) = R_i + R_G\\)\nThe return ratio for the gain element \\(g_m\\) with port under consideration shorted is:\n\\(T_{sc} = -\\dfrac{i_r}{i_t} |_{sc} = 0\\)\nShorting the port forces \\(v_{gs}=0\\) so it “kills” the \\(g_m\\) generator.\nThe return ratio for the gain element \\(g_m\\) with port under consideration open is:\n\\(T_{open} = -\\dfrac{i_r}{i_t} |_{open} = g_m \\cdot R_i\\)\n\n\n\n\n\n\n\n\nFigure 71: return ratio with port G-S open\n\n\n\n\n\n\\(v_s = i_t \\cdot R_i\\)\n\\(v_g = 0 \\Rightarrow v_{gs} = - i_t \\cdot R_i\\)\n\\(i_r = g_m v_{gs} = -g_m R_i i_t\\)\nThe closed-loop port impedance between G and S is: \\[\nR_{gs} = R_{gs}(g_m=0) \\cdot \\dfrac{1+T_{sc}}{1+T_{open}} = \\dfrac{R_i+R_G}{1+g_mR_i}\n\\]\nExample 15 - Voltage gain and output resistance of common source with degeneration using return ratio\n\n\n\n\n\n\n\n\nFigure 72: Common source with degeneration\n\n\n\n\n\n\nvoltage gain (assuming \\(r_o\\) negligible)\n\n\\[\nA_v = \\dfrac{v_{out}}{v_{in}} = A_{\\infty} \\cdot \\dfrac{T}{1+T} + \\dfrac{d}{1+T}\n\\]\n\\(A_{\\infty}\\) is the gain of the circuit when the gain element k of the controlled source tends to \\(\\infty\\) (note that if \\(k = g_m = \\infty\\), for the current of the dependent source to be finite, it must be \\(v_{gs} = 0\\)).\n\\(A_{\\infty} = \\dfrac{v_{out}}{v_{in}} |_{g_m \\rightarrow \\infty}= - \\dfrac{R_D}{R_S}\\)\n\\(d\\) is the gain of the circuit when the gain element k of the controlled source equals 0.\n\\(d = \\dfrac{v_{out}}{v_{in}} |_{g_{m} = 0} = 0\\)\n\\(T\\) is the return ratio of the dependent source.\nTo compute the return ratio instead of separating the dependent source from the rest of the circuit and replacing it with an independent source of the same kind as always done so far, we will follow an equivalent procedure consisting of adding an independent source \\(s_x\\). In practice, this procedure is usually more easily performed, because it does not require tearing the original circuit apart. See (Middlebrook 2006) and (Hajimiri 2023).\nThe introduction of \\(s_x\\) is completely equivalent to using an independent source \\(s_t\\) in place of the separated dependent source and monitoring the signal \\(s_r\\) that returns to the separated dependent source.\n\\(s_t = s_x + s_r\\)\n\n\n\n\n\n\n\n\nFigure 73: Small signal model to find the return ratio of \\(g_{m}\\)\n\n\n\n\n\n\\(v_{gs} = - i_t R_S\\)\n\\(i_r = g_m v_{gs} = - g_m R_S i_t\\)\n\\(T = -\\dfrac{i_r}{i_t} = g_m R_S\\)\nTherefore, as expected:\n\\[\nA_v = \\dfrac{v_{out}}{v_{in}} = A_{\\infty} \\cdot \\dfrac{T}{1+T} + \\dfrac{d}{1+T} = \\dfrac{-g_m R_D}{1 + g_m R_S}\n\\]\n\nOutput resistance\n\n To find the output resistance we use Blackman’s formula.\n\n\n\n\n\n\n\n\nFigure 74: Small signal model to find the output resistance\n\n\n\n\n\nThe output resistance with \\(g_m=0\\) is:\n\\(R_{out}(g_m=0) = R_S = r_o\\)\n\n\n\n\n\n\n\n\nFigure 75: return ratio with output port open\n\n\n\n\n\nWith the output port open:\n\\(v_{gs} = - i_t R_S = 0 \\Rightarrow i_r = g_m v_{gs} = 0\\)\nSo, the return ratio with the output port open is:\n\\(T_{open} = - \\dfrac{i_r}{i_t} |_{open} = 0\\)\n\n\n\n\n\n\n\n\nFigure 76: return ratio with output port shorted\n\n\n\n\n\nWith the output port shorted:\n\\(v_{gs} = - (R_S || r_o) \\cdot i_t \\Rightarrow i_r = g_m v_{gs} = - g_m \\cdot (R_S|| r_o) \\cdot i_t\\)\nSo, the return ratio with the output port shorted is:\n\\(T_{sc} = - \\dfrac{i_r}{i_t} |_{sc} = g_m (R_S||r_o)\\)\nAnd the output resistance is:\n\\[\n\\begin{split}\nR_{out} &= R_{out}(g_m=0) \\cdot \\dfrac{1 + T_{sc}}{1 + T_{open}} = (R_S + r_o) \\left( 1 + g_m\\dfrac{R_S r_o}{R_S + r_o} \\right) = \\\\\n&= R_S + r_o (1 + g_m R_S)\n\\end{split}\n\\]\n\n\n8.3 Summary - Return Ratio Analysis\n\nReturn-ratio analysis is an alternative approach to two-port feedback analysis.\nProvided the return ratio T is computed for a dependnt source that breaks the feedback loop globally, the return ratio is a measure of loop gain. In general, the return ratio of a controlled source is a measure of how much of the signal generated by that controlled source is returned due to feedback, it is not necessarily the loop gain (Hurst 1992).\nFor negative feedback circuits T &gt; 0\nIn an ideal feedback system \\(T \\rightarrow \\infty\\) and the closed loop gain is \\(A_{\\infty}\\)\nBlackman’s formula gives the closed-loop impedance in terms of two return ratios. The formula is the same for any type of feedback circuit, and it applies to any port (not only the input and output ports)\nReturn ratio analysis is often simpler than two-port analayis\nReturn ratio analysis uses equations that are independent of the type of feedback.\nTwo-port analysis uses four-feedback configurations (series-series, series-shunt, shunt-series, and shunt-shunt), therefore, the type of feedback must be correctly identified before starting the analysis\nIn practice, all physical networks are multiloop feedback structures. Unwanted local return loops exists around individual transistor through the parasitic capacitances (Tian et al. 2001) (Behmanesh and Andreani 2023). Dealing with multiple feedback mechanisms makes identifying an appropriate controlled source to use for the return ratio analysis more difficult. When dealing with multiloop feedback structures, the controlled source used to compute the return ratio, must be one that breaks the loop globally (Hurst and Lewis 1995).\nOne aspect that is often cause of confusion, about return-ratio analysis and two-port analysisis is that the loop gain L computed through two-port analysis and the loop gain T computed using the return ratio, can be different. This is because they are intrinsically two different measures of transmission, however both methods lead to correct closed-loop expressions and both can be used to check stability (Chiu 2012)."
  },
  {
    "objectID": "images/fig-bf-1.html",
    "href": "images/fig-bf-1.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Feedback circuit to derive Blackman’s formula with respect to port x"
  },
  {
    "objectID": "images/fig-bf-11.html",
    "href": "images/fig-bf-11.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Super-source follower stage"
  },
  {
    "objectID": "images/fig-bf-13.html",
    "href": "images/fig-bf-13.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Return Ratio for \\(g_{m2}\\) with the output port shorted"
  },
  {
    "objectID": "images/fig-bf-15.html",
    "href": "images/fig-bf-15.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Shunt-shunt stage (Transimpedance Amplifier)"
  },
  {
    "objectID": "images/fig-bf-17.html",
    "href": "images/fig-bf-17.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal model to find the return ratio for \\(g_{m}\\)"
  },
  {
    "objectID": "images/fig-bf-19.html",
    "href": "images/fig-bf-19.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Return ratio for \\(a_v\\) with the output port open"
  },
  {
    "objectID": "images/fig-bf-20.html",
    "href": "images/fig-bf-20.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Return ratio for \\(a_v\\) with the output port shorted"
  },
  {
    "objectID": "images/fig-bf-22.html",
    "href": "images/fig-bf-22.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal model for ZVTC calculations, assuming \\(r_o\\) can be ignored"
  },
  {
    "objectID": "images/fig-bf-24.html",
    "href": "images/fig-bf-24.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Common source with degeneration"
  },
  {
    "objectID": "images/fig-bf-26.html",
    "href": "images/fig-bf-26.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Small signal model to find the output resistance"
  },
  {
    "objectID": "images/fig-bf-28.html",
    "href": "images/fig-bf-28.html",
    "title": "",
    "section": "",
    "text": "Figure 1: return ratio with output port shorted"
  },
  {
    "objectID": "images/fig-bf-4.html",
    "href": "images/fig-bf-4.html",
    "title": "",
    "section": "",
    "text": "Figure 1: T(with input port open) for non inverting configuration"
  },
  {
    "objectID": "images/fig-bf-6.html",
    "href": "images/fig-bf-6.html",
    "title": "",
    "section": "",
    "text": "Figure 1: T(with output port shorted) for non-inverting configuration"
  },
  {
    "objectID": "images/fig-bf-8.html",
    "href": "images/fig-bf-8.html",
    "title": "",
    "section": "",
    "text": "Figure 1: A bootstrapped source follower stage"
  },
  {
    "objectID": "images/fig-fb-1.html",
    "href": "images/fig-fb-1.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram of a feedback system."
  },
  {
    "objectID": "images/fig-fb-2.html",
    "href": "images/fig-fb-2.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram of a negative feedback system."
  },
  {
    "objectID": "images/fig-fb-4.html",
    "href": "images/fig-fb-4.html",
    "title": "",
    "section": "",
    "text": "Figure 1: op amp based voltage buffer"
  },
  {
    "objectID": "images/fig-fb-6.html",
    "href": "images/fig-fb-6.html",
    "title": "",
    "section": "",
    "text": "Figure 1: op amp based non inverting voltage amplifier"
  },
  {
    "objectID": "images/fig-fb-oa-1.html",
    "href": "images/fig-fb-oa-1.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram of negative feedback system."
  },
  {
    "objectID": "images/fig-fb-oa-11.html",
    "href": "images/fig-fb-oa-11.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram model valid for both topologies."
  },
  {
    "objectID": "images/fig-fb-oa-6.html",
    "href": "images/fig-fb-oa-6.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Breaking the loop (\\(v_f=0\\))"
  },
  {
    "objectID": "images/fig-fb-oa-8.html",
    "href": "images/fig-fb-oa-8.html",
    "title": "",
    "section": "",
    "text": "Figure 1: op amp based inverting amplifier with break in the loop (\\(v_f = 0\\))"
  },
  {
    "objectID": "images/fig-rr-1.html",
    "href": "images/fig-rr-1.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Feedback amplifier: return ratio framework to derive the closed-loop gain"
  },
  {
    "objectID": "images/fig-rr-11.html",
    "href": "images/fig-rr-11.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Unrolled AC equivalent model for the constant-\\(g_m\\) bias circuit"
  },
  {
    "objectID": "images/fig-rr-13.html",
    "href": "images/fig-rr-13.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Computing the return ratio for the constant-\\(g_m\\) bias circuit"
  },
  {
    "objectID": "images/fig-rr-15.html",
    "href": "images/fig-rr-15.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Constant-\\(g_m\\) reference: design example"
  },
  {
    "objectID": "images/fig-rr-2.html",
    "href": "images/fig-rr-2.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Block diagram for closed-loop gain using return ratio framework"
  },
  {
    "objectID": "images/fig-rr-4.html",
    "href": "images/fig-rr-4.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Common source with current-source biasing"
  },
  {
    "objectID": "images/fig-rr-6.html",
    "href": "images/fig-rr-6.html",
    "title": "",
    "section": "",
    "text": "Figure 1: return ratio calculation"
  },
  {
    "objectID": "images/fig-rr-8.html",
    "href": "images/fig-rr-8.html",
    "title": "",
    "section": "",
    "text": "Figure 1: Direct feedthrough calculation"
  }
]